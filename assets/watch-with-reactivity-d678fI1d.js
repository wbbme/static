import{u as l,c as n,w as i,_ as r,o as h,a as s,d as t}from"./app-NfkmQghJ.js";const p=s("div",{class:"prose m-auto slide-enter-content"},[s("p",null,[s("div",{class:"table-of-contents"},[s("div",{class:"table-of-contents-anchor"},[s("div",{class:"i-ri-menu-2-fill"})]),s("ul",null,[s("li",null,[s("a",{href:"#understanding-vue-reactivity"},"Understanding @vue/reactivity "),s("ul",null,[s("li",null,[s("a",{href:"#computed"},"Computed ")])])]),s("li",null,[s("a",{href:"#effect"},"Effect ")]),s("li",null,[s("a",{href:"#build-yourself-a-watch"},"Build yourself a watch "),s("ul",null,[s("li",null,[s("a",{href:"#the-basic"},"The Basic ")]),s("li",null,[s("a",{href:"#watch-for-ref"},"Watch for Ref ")]),s("li",null,[s("a",{href:"#watch-deeply"},"Watch Deeply ")])])]),s("li",null,[s("a",{href:"#lifecycles"},"Lifecycles ")]),s("li",null,[s("a",{href:"#take-away"},"Take Away ")])])])]),s("p",null,[s("a",{href:"https://twitter.com/antfu7/status/1298667080804233221",target:"_blank",rel:"noopener"},"As you probably know"),t(", the things I excited most in Vue 3 are the "),s("a",{href:"https://v3.vuejs.org/guide/composition-api-introduction.html",target:"_blank",rel:"noopener"},"Composition API"),t(" and the "),s("a",{href:"https://v3.vuejs.org/guide/reactivity.html",target:"_blank",rel:"noopener"},"reactivity system"),t(". With the Composition API we can reuse logics and states across components or even apps. Whatâ€™s better? The underhood reactivity system is decoupled from Vue, which means you can use it almost everywhere, even without UI.")]),s("p",null,"Here are some proof of concepts for using the reactivity system outside of Vue:"),s("ul",null,[s("li",null,[s("p",null,[s("a",{href:"https://github.com/yyx990803/vue-lit",target:"_blank",rel:"noopener"},[s("code",null,"@vue/lit")]),t(" is a minimal framework wrote by Evan combining "),s("a",{href:"https://github.com/vuejs/core/tree/main/packages/reactivity",target:"_blank",rel:"noopener"},[s("code",null,"@vue/reactivity")]),t(" and "),s("a",{href:"https://lit-html.polymer-project.org/",target:"_blank",rel:"noopener"},[s("code",null,"lit-html")]),t(". It can run directly in browsers, with the almost identical experience as Vue Composition API.")])]),s("li",null,[s("p",null,[s("a",{href:"https://github.com/antfu/reactivue",target:"_blank",rel:"noopener"},[s("code",null,"ReactiVue")]),t(" ports Vue Composition API to React. It also provides Reactâ€™s lifecycles in the Vue style.")])])]),s("p",null,[t("Furthermore, you can even use Vueâ€™s libraries in them. Tested with "),s("a",{href:"https://github.com/antfu/vueuse",target:"_blank",rel:"noopener"},[s("code",null,"VueUse")]),t(" and "),s("a",{href:"https://github.com/posva/pinia",target:"_blank",rel:"noopener"},[s("code",null,"pinia")]),t(" in "),s("a",{href:"https://github.com/antfu/reactivue",target:"_blank",rel:"noopener"},[s("code",null,"ReactiVue")]),t(", and they just work. You can find "),s("a",{href:"https://github.com/antfu/reactivue#using-vues-libraries",target:"_blank",rel:"noopener"},"more details and examples here"),t(".")]),s("p",null,[t("I am also experimenting more possibility of Vue reactivity in other scenarios, for example "),s("a",{href:"https://twitter.com/antfu7/status/1305313110903779330?s=20",target:"_blank",rel:"noopener"},"reactive file system"),t(", in a project called "),s("code",null,"tive"),t(". Itâ€™s currently a WIP private repo, but keep tuned, I get more to come ðŸ˜‰!")]),s("h2",{id:"understanding-vue-reactivity",tabindex:"-1"},[t("Understanding "),s("code",null,"@vue/reactivity"),t(),s("a",{class:"header-anchor",href:"#understanding-vue-reactivity","aria-hidden":"true"},"#")]),s("p",null,[t('"reactive objects" returned by '),s("code",null,"ref()"),t(" or "),s("code",null,"reactive()"),t(" are actually "),s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",target:"_blank",rel:"noopener"},"Proxies"),t(". Those proxies will trigger some actions to track the changes on properties accessing or writing.")]),s("p",null,"For a simplified example,"),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"function"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," reactive"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"target"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," new"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," Proxy"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"target"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"    get"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"target"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},", "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"prop"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},", "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"receiver"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"      track"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"target"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},", "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"prop"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"      return"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," Reflect"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"get"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"(..."),s("span",{style:{"--s-dark":"#C99076","--s-light":"#A65E2B"}},"arguments"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") "),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// get the original data")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"    },")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"    set"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"target"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},", "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"key"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},", "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},", "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"receiver"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"      trigger"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"target"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},", "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"key"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"      return"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," Reflect"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"set"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"(..."),s("span",{style:{"--s-dark":"#C99076","--s-light":"#A65E2B"}},"arguments"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") "),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// set the original data")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"    }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  })")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"obj"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," reactive"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"({")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"  hello"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"'"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"world"),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"'")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"})")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"console"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"log"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"obj"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"hello"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}}," // `track()` get called")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"obj"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"hello"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}}," '"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"vue"),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"'"),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}}," // `trigger()` get called")]),t(`
`),s("span",{class:"line"})])]),s("p",null,"So in this way, vue can be notified when those properties get accessed or when they be modified."),s("blockquote",null,[s("p",null,[t("For more detailed explanations, check out the "),s("a",{href:"https://v3.vuejs.org/guide/reactivity.html#what-is-reactivity",target:"_blank",rel:"noopener"},"official docs")])]),s("h3",{id:"computed",tabindex:"-1"},[t("Computed "),s("a",{class:"header-anchor",href:"#computed","aria-hidden":"true"},"#")]),s("p",null,[t("Since we are able to know those events, we can start diving into the "),s("code",null,"computed"),t(' which is where the "reactive" magic start shining.')]),s("p",null,[s("code",null,"computed"),t(" is like a getter that auto collects the reactive dependencies source and auto re-evaluate when they get changed.")]),s("p",null,"For example,"),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"counter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," ref"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#4C9A91","--s-light":"#2F798A"}},"1"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"multiplier"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," ref"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#4C9A91","--s-light":"#2F798A"}},"2"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"result"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," computed"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"(()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," counter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," * "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"multiplier"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"console"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"log"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"result"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}}," // 2")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"counter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," +="),s("span",{style:{"--s-dark":"#4C9A91","--s-light":"#2F798A"}}," 1")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"console"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"log"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"result"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}}," // 4")]),t(`
`),s("span",{class:"line"})])]),s("p",null,[t("To know how the "),s("code",null,"computed"),t(" work, we need to dig into the lower level API "),s("code",null,"effect"),t(" first.")]),s("h2",{id:"effect",tabindex:"-1"},[t("Effect "),s("a",{class:"header-anchor",href:"#effect","aria-hidden":"true"},"#")]),s("p",null,[s("code",null,"effect"),t(' is a new API introduced in Vue 3. Underneath, itâ€™s the engine powers the "reactivity" in '),s("code",null,"computed"),t(" and "),s("code",null,"watch"),t(". For the most of the time, you donâ€™t need to directly use it. But knowing it well helps you understand the reactivity system much easier.")]),s("p",null,[s("code",null,"effect"),t(" takes the first argument as the "),s("code",null,"getter"),t(" and a second argument for the options. The "),s("code",null,"getter"),t(" is the function that collect its deps on each run via their "),s("code",null,"track()"),t(" hooks. The field "),s("code",null,"scheduler"),t(" in options provides a way to invoke a custom function when the deps change.")]),s("p",null,[t("So basically, you can write a simple "),s("code",null,"computed"),t(" on your own like:")]),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"function"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," computed"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  let "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  let "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"dirty"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," true")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"runner"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," effect"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"    lazy"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"true"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"    scheduler"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"() {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"      dirty"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," = "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"true"),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}}," // deps changed")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"    }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  })")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // return should be a `Ref` in real world, simplified here")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"    get"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"() {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"      if"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"dirty"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"        value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," = "),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"runner"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"() "),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// re-evaluate")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"        dirty"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," = "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"false")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"      }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"      return"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," value")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"    }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),t(`
`),s("span",{class:"line"})])]),s("p",null,[t("If you really interested in how it works in Vue, check out "),s("a",{href:"https://github.com/vuejs/core/blob/main/packages/reactivity/src/computed.ts",target:"_blank",rel:"noopener"},"the source code here")]),s("h2",{id:"build-yourself-a-watch",tabindex:"-1"},[t("Build yourself a "),s("code",null,"watch"),t(),s("a",{class:"header-anchor",href:"#build-yourself-a-watch","aria-hidden":"true"},"#")]),s("p",null,[t("We have done the most important APIs in "),s("code",null,"@vue/reactivity"),t(" now, which is "),s("code",null,"ref"),t(),s("code",null,"reactive"),t(),s("code",null,"effect"),t(),s("code",null,"computed"),t(".")]),s("p",null,[t("Oh wait, we are missing the "),s("code",null,"watch"),t(" here!")]),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-js"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"import"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," watch"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," }"),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," from"),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}}," '"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"@vue/reactivity"),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"'"),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}}," // does NOT exist!")]),t(`
`),s("span",{class:"line"})])]),s("p",null,[t("If you take a look at Vue 3â€™s source code, you will find that "),s("code",null,"watch"),t(" is actually "),s("a",{href:"https://github.com/vuejs/core/blob/main/packages/runtime-core/src/apiWatch.ts",target:"_blank",rel:"noopener"},[t("implemented in "),s("code",null,"@vue/runtime-core")]),t(", along with the Vueâ€™s component model and lifecycles. The main reason for this is that "),s("code",null,"watch"),t(" is deep bound with the componentâ€™s lifecycles (auto dispose, invalidate, etc.). But it shouldnâ€™t be the thing to keep you from using it outside of Vue.")]),s("p",null,[t("Letâ€™s implement the "),s("code",null,"watch"),t(" our own!")]),s("h3",{id:"the-basic",tabindex:"-1"},[t("The Basic "),s("a",{class:"header-anchor",href:"#the-basic","aria-hidden":"true"},"#")]),s("p",null,"Letâ€™s take a look at Vueâ€™s watch interface first"),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"count"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," ref"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#4C9A91","--s-light":"#2F798A"}},"0"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"watch"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"(")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," count"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"newValue"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    console"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"log"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"`"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"count changed to: "),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"${"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"newValue"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"!"),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"`"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"count"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4C9A91","--s-light":"#2F798A"}}," 2")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// count changed to: 2!")]),t(`
`),s("span",{class:"line"})])]),s("p",null,[t("With the knowledge of "),s("code",null,"effect"),t(", itâ€™s quite straight forward to implement")]),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"function"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," watch"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," fn"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"runner"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," effect"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"    lazy"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"true"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"    scheduler"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"fn")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  })")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // a callback function is returned to stop the effect")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," stop"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"runner"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),t(`
`),s("span",{class:"line"})])]),s("p",null,"Watch is lazy by default in Vue, you can add the third options to give control to the users."),s("h3",{id:"watch-for-ref",tabindex:"-1"},[t("Watch for Ref "),s("a",{class:"header-anchor",href:"#watch-for-ref","aria-hidden":"true"},"#")]),s("p",null,[t("You may also notice that the Vueâ€™s "),s("code",null,"watch"),t(" also allows passing the ref directly to it.")]),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"watch"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"(")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  count"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {"),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}}," /* onChanged */"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"})])]),s("p",null,"For that, just wrap it into a getter will do"),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"function"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," watch"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"source"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," fn"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," isRef"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"source"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"    ?"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," source"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"    :"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," source")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"runner"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," effect"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"    lazy"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"true"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"    scheduler"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"fn")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  })")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," stop"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"runner"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),t(`
`),s("span",{class:"line"})])]),s("h3",{id:"watch-deeply",tabindex:"-1"},[t("Watch Deeply "),s("a",{class:"header-anchor",href:"#watch-deeply","aria-hidden":"true"},"#")]),s("p",null,[t("One other great feature about "),s("code",null,"watch"),t(" is that it allows you to watch on deep changes.")]),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"state"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," reactive"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"({")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"  info"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"    name"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"'"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"Anthony"),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"'"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"})")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"watch"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"state"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," console"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"log"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"'"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"changed!"),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"'"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"),"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," { "),s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"deep"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"true"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," })")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"state"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"info"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"name"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}}," '"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"Anthony Fu"),s("span",{style:{"--s-dark":"#C98A7D99","--s-light":"#B5695999"}},"'")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// changed!")]),t(`
`),s("span",{class:"line"})])]),s("p",null,[t("To implement this feature, you need to collect the "),s("code",null,"track()"),t(" events on every nested property. We can achieve that with a "),s("code",null,"traverse"),t(" function.")]),s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"function"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," traverse"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," seen"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," new"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," Set"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"())"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  if"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"!"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"isObject"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," ||"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," seen"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"has"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"))")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"    return"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," value")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  seen"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"add"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}}," // prevent circular reference")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  if"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"isArray"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"))"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"    for"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"let "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"i"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4C9A91","--s-light":"#2F798A"}}," 0"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},";"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," i"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," <"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"length"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},";"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," i"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"++"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"      traverse"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"["),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"i"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"],"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," seen"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  else"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"    for"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"key"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," Object"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"keys"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"))")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"      traverse"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"["),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"key"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"],"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," seen"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," value")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"function"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," watch"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"source"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," fn"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," deep"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," lazy"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," true"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," })"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  let "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," isRef"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"source"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"    ?"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," source"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"value")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"    :"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," isReactive"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"source"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"      ?"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," source")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"      :"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," source")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  if"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"deep"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"    getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," traverse"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"())")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"runner"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," effect"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"getter"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    lazy"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#B8A965","--s-light":"#998418"}},"    scheduler"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"fn")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  })")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," stop"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"runner"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),t(`
`),s("span",{class:"line"})])]),s("p",null,[t("Done! The thing left to do is to polish, adding overloads to make it more flexible, add more options to get better control, and handle some edge cases. Then you should get yourself a good start for using a custom "),s("code",null,"watch"),t("!")]),s("h2",{id:"lifecycles",tabindex:"-1"},[t("Lifecycles "),s("a",{class:"header-anchor",href:"#lifecycles","aria-hidden":"true"},"#")]),s("p",null,[t("In Vue, "),s("code",null,"computed"),t(" and "),s("code",null,"watch"),t(" will automatically bind their "),s("code",null,"effect"),t(" runner to the current component instance. When the component get unmounted, the effects bond to it will be auto disposed. More specially, you can read "),s("a",{href:"https://github.com/vuejs/core/blob/985bd2bcb5fd8bccd1c15c8c5d89a6919fd73922/packages/runtime-core/src/apiWatch.ts#L294",target:"_blank",rel:"noopener"},"the source code here"),t(".")]),s("p",null,"Since we donâ€™t have an instance, if you want to stop those effects, you have to do them manually. When you have multiple effects in used, to stop them together, you have to manually collect them together. One easier way is to mock similar lifecycles like Vue. This requires some amount of works, I will explain that in another blog post. Please keep tuned."),s("h2",{id:"take-away",tabindex:"-1"},[t("Take Away "),s("a",{class:"header-anchor",href:"#take-away","aria-hidden":"true"},"#")]),s("p",null,[t("Thanks for reading! And hope it is helpful for you to understand and better play with the Vue reactivity system. If you want to have the "),s("code",null,"watch"),t(" outside of Vue, I made one for you (much more robust than the examples above for sure).")]),s("pre",{class:"block language-bash"},[t("npm i "),s("a",{href:"https://github.com/antfu/vue-reactivity-watch",target:"_blank"},"@vue-reactivity/watch"),t(`
`)]),s("p",null,"Have fun ;P")],-1),o={__name:"watch-with-reactivity",setup(d){const a={title:"Watch with @vue/reactivity",description:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own.",date:"2020-09-18T00:00:00.000Z",lang:"en",duration:"12min",image:"https://antfu.me/og/watch-with-reactivity.png",meta:[{property:"og:title",content:"Watch with @vue/reactivity"},{name:"twitter:title",content:"Watch with @vue/reactivity"},{name:"description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{name:"twitter:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:card",content:"summary_large_image"}]};return l({title:"Watch with @vue/reactivity",meta:[{property:"og:title",content:"Watch with @vue/reactivity"},{name:"twitter:title",content:"Watch with @vue/reactivity"},{name:"description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{name:"twitter:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:card",content:"summary_large_image"}]}),(y,k)=>{const e=r;return h(),n(e,{frontmatter:a},{default:i(()=>[p]),_:1})}}};export{o as default};
